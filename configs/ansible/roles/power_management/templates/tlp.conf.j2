# TLP Configuration - Generated by Ansible
# {{ ansible_managed }}

# Set to 0 to disable, 1 to enable TLP.
TLP_ENABLE={{ '1' if tlp.enabled else '0' }}

# Operation mode when no power supply can be detected: AC, BAT.
TLP_DEFAULT_MODE=AC

# Operation mode select: 0=depend on power source, 1=always use TLP_DEFAULT_MODE
TLP_PERSISTENT_DEFAULT=0

# Hint: use tlp-stat -s to show the active settings

# Define disk devices on which the following DISK/AHCI_RUNTIME_PM settings act.
DISK_DEVICES="nvme0n1 sda"

# Disk advanced power management level: 1-254, 255 (max saving, min, off).
DISK_APM_LEVEL_ON_AC="254 254"
DISK_APM_LEVEL_ON_BAT="128 128"

# Hard disk spin down timeout:
DISK_SPINDOWN_TIMEOUT_ON_AC="0 0"
DISK_SPINDOWN_TIMEOUT_ON_BAT="0 0"

# Select IO scheduler for the disk devices.
DISK_IOSCHED="mq-deadline mq-deadline"

# AHCI link power management (ALPM) for disk devices.
AHCI_RUNTIME_PM_ON_AC=on
AHCI_RUNTIME_PM_ON_BAT=auto
AHCI_RUNTIME_PM_TIMEOUT=15

# PCI Express Active State Power Management (PCIe ASPM).
PCIE_ASPM_ON_AC=default
PCIE_ASPM_ON_BAT=default

# Set Intel CPU energy/performance policies HWP.EPP and EPB.
CPU_ENERGY_PERF_POLICY_ON_AC={{ tlp.cpu_energy_perf_policy_on_ac }}
CPU_ENERGY_PERF_POLICY_ON_BAT={{ tlp.cpu_energy_perf_policy_on_bat }}

# Set Intel CPU P-state performance: 0..100 (%).
CPU_MIN_PERF_ON_AC={{ cpu.min_perf_pct_ac }}
CPU_MAX_PERF_ON_AC={{ cpu.max_perf_pct_ac }}
CPU_MIN_PERF_ON_BAT={{ cpu.min_perf_pct_battery }}
CPU_MAX_PERF_ON_BAT={{ cpu.max_perf_pct_battery }}

# Set the CPU governor.
CPU_SCALING_GOVERNOR_ON_AC={{ tlp.cpu_scaling_governor_on_ac }}
CPU_SCALING_GOVERNOR_ON_BAT={{ tlp.cpu_scaling_governor_on_bat }}

# CPU frequency scaling
CPU_SCALING_MIN_FREQ_ON_AC=0
CPU_SCALING_MAX_FREQ_ON_AC=0
CPU_SCALING_MIN_FREQ_ON_BAT=0
CPU_SCALING_MAX_FREQ_ON_BAT=0

# Set the CPU frequency boost feature.
CPU_BOOST_ON_AC={{ '1' if cpu.turbo_boost_ac else '0' }}
CPU_BOOST_ON_BAT={{ '1' if cpu.turbo_boost_battery else '0' }}

# Kernel NMI Watchdog:
NMI_WATCHDOG={{ tlp.nmi_watchdog }}

# Change CPU voltages aka "undervolting" - Kernel with PHC patch required.
PHC_CONTROLS="F:V F:V F:V F:V"

# Set GPU frequency limits for Intel GPU.
INTEL_GPU_MIN_FREQ_ON_AC=0
INTEL_GPU_MIN_FREQ_ON_BAT=0
INTEL_GPU_MAX_FREQ_ON_AC=0
INTEL_GPU_MAX_FREQ_ON_BAT=0
INTEL_GPU_BOOST_FREQ_ON_AC=0
INTEL_GPU_BOOST_FREQ_ON_BAT=0

# WiFi power saving mode: on=enable, off=disable; not supported by all adapters.
WIFI_PWR_ON_AC={{ tlp.wifi_pwr_on_ac }}
WIFI_PWR_ON_BAT={{ tlp.wifi_pwr_on_bat }}

# Disable wake on LAN: Y/N.
WOL_DISABLE={{ tlp.wol_disable }}

# Enable audio power saving for Intel HDA, AC97 devices (timeout in secs).
SOUND_POWER_SAVE_ON_AC={{ tlp.sound_power_save_on_ac }}
SOUND_POWER_SAVE_ON_BAT={{ tlp.sound_power_save_on_bat }}

# Disable controller too (HDA only): Y/N.
SOUND_POWER_SAVE_CONTROLLER={{ tlp.sound_power_save_controller }}

# Power off optical drive in UltraBay/MediaBay: 0=disable, 1=enable.
BAY_POWEROFF_ON_AC={{ tlp.bay_poweroff_on_bat }}
BAY_POWEROFF_ON_BAT={{ tlp.bay_poweroff_on_bat }}

# Optical drive device to power off.
BAY_DEVICE={{ tlp.bay_device }}

# Runtime Power Management for SATA, ATA and USB devices.
RUNTIME_PM_ON_AC={{ tlp.runtime_pm_on_ac }}
RUNTIME_PM_ON_BAT={{ tlp.runtime_pm_on_bat }}

# Runtime PM for *all* PCI(e) bus devices: on=disable, auto=enable.
RUNTIME_PM_ALL=1

# Exclude listed PCIe device adresses from Runtime PM.
RUNTIME_PM_BLACKLIST="01:00.0"

# Include listed PCIe device adresses into Runtime PM.
RUNTIME_PM_WHITELIST=""

# Set to 0 to disable, 1 to enable USB autosuspend feature.
USB_AUTOSUSPEND={{ tlp.usb_autosuspend }}

# Exclude listed devices from USB autosuspend.
USB_BLACKLIST="{{ tlp.usb_blacklist_btusb | ternary('usb-device-blacklist', '') }}"

# Include listed devices into USB autosuspend even if already blacklisted.
USB_WHITELIST=""

# Set to 1 to disable autosuspend before shutdown, 0 to do nothing.
USB_AUTOSUSPEND_DISABLE_ON_SHUTDOWN=1

# Restore radio device state (Bluetooth, WiFi, WWAN) on startup.
RESTORE_DEVICE_STATE_ON_STARTUP={{ tlp.restore_device_state_on_startup }}

# Radio devices to disable on startup: bluetooth, wifi, wwan.
DEVICES_TO_DISABLE_ON_STARTUP=""

# Radio devices to enable on startup: bluetooth, wifi, wwan.
DEVICES_TO_ENABLE_ON_STARTUP=""

# Radio devices to disable on shutdown: bluetooth, wifi, wwan.
DEVICES_TO_DISABLE_ON_SHUTDOWN=""

# Radio devices to enable on shutdown: bluetooth, wifi, wwan.
DEVICES_TO_ENABLE_ON_SHUTDOWN=""

# Radio devices to disable on battery: bluetooth, wifi, wwan.
DEVICES_TO_DISABLE_ON_BAT=""

# Radio devices to disable on battery when not in use.
DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE=""

# Battery charge thresholds (ThinkPad only, tp-smapi or acpi-call kernel module required).
START_CHARGE_THRESH_BAT0={{ tlp.start_charge_thresh_bat0 }}
STOP_CHARGE_THRESH_BAT0={{ tlp.stop_charge_thresh_bat0 }}
START_CHARGE_THRESH_BAT1=96
STOP_CHARGE_THRESH_BAT1=100

# Hybrid standby / suspend-to-both mode on low battery (ThinkPad only).
NATACPI_ENABLE=1
TPACPI_ENABLE=1
TPSMAPI_ENABLE=1