<!-- D-Bus session configuration template -->
<!-- Generated by Ansible for {{ ansible_hostname }} -->

<!DOCTYPE busconfig PUBLIC "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- Session bus configuration -->
  
  <!-- Listen on Unix domain socket -->
  <listen>unix:tmpdir={{ dbus_tmpdir | default('/tmp') }}</listen>
  
  <!-- Security policies -->
  <policy context="default">
    <!-- Allow everything to be sent -->
    <allow send_destination="*" eavesdrop="true"/>
    <!-- Allow everything to be received -->
    <allow eavesdrop="true"/>
    <!-- Allow anyone to own anything -->
    <allow own="*"/>
  </policy>

  <!-- Hyprland specific policies -->
  <policy user="{{ hyprland_user | default(users.main_user) }}">
    <allow own="org.hyprland.*"/>
    <allow send_destination="org.hyprland.*"/>
    <allow receive_sender="org.hyprland.*"/>
  </policy>

  <!-- Desktop notifications -->
  <policy context="default">
    <allow own="org.freedesktop.Notifications"/>
    <allow send_destination="org.freedesktop.Notifications"/>
  </policy>

  <!-- Portal access -->
  <policy context="default">
    <allow own="org.freedesktop.portal.*"/>
    <allow send_destination="org.freedesktop.portal.*"/>
  </policy>

  <!-- Audio services -->
  <policy context="default">
    <allow own="org.PulseAudio*"/>
    <allow send_destination="org.PulseAudio*"/>
    <allow own="org.freedesktop.ReserveDevice1.*"/>
  </policy>

  <!-- Network management -->
  <policy context="default">
    <allow send_destination="org.freedesktop.NetworkManager"/>
    <allow send_interface="org.freedesktop.NetworkManager.*"/>
  </policy>

{% if enable_debug | default(false) %}
  <!-- Debug logging -->
  <syslog/>
{% endif %}

  <!-- Resource limits -->
  <limit name="max_incoming_bytes">{{ dbus_max_incoming | default('1000000000') }}</limit>
  <limit name="max_outgoing_bytes">{{ dbus_max_outgoing | default('1000000000') }}</limit>
  <limit name="max_message_size">{{ dbus_max_message_size | default('1000000000') }}</limit>

</busconfig>